Error loading model model_ResNet50_HPF_Enabled.keras: Unknown model type for D:\JOB_DATN\steganography_system\models\model_ResNet50_HPF_Enabled.keras
Traceback (most recent call last):
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_builder.py", line 188, in load_model_with_reconstruction
    model = tf.keras.models.load_model(model_path, custom_objects=custom_objects)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_api.py", line 189, in load_model
    return saving_lib.load_model(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 365, in load_model
    return _load_model_from_fileobj(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 442, in _load_model_from_fileobj
    model = _model_from_config(
            ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 431, in _model_from_config
    model = deserialize_keras_object(
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\serialization_lib.py", line 733, in deserialize_keras_object
    instance = cls.from_config(inner_config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\models\model.py", line 694, in from_config
    return functional_from_config(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\models\functional.py", line 577, in functional_from_config
    process_node(layer, node_data)
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\models\functional.py", line 507, in process_node
    layer(*args, **kwargs)
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\utils\traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\layers\core\lambda_layer.py", line 95, in compute_output_shape
    raise NotImplementedError(
NotImplementedError: Exception encountered when calling Lambda.call().

[1mWe could not automatically infer the shape of the Lambda's output. Please specify the `output_shape` argument for this Lambda layer.[0m

Arguments received by Lambda.call():
  • args=('<KerasTensor shape=(None, 224, 224, 30), dtype=float32, sparse=False, ragged=False, name=keras_tensor_928>',)
  • kwargs={'mask': 'None'}

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_service.py", line 47, in load_model
    model = load_model_with_reconstruction(str(model_path))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_builder.py", line 202, in load_model_with_reconstruction
    raise ValueError(f"Unknown model type for {model_path}")
ValueError: Unknown model type for D:\JOB_DATN\steganography_system\models\model_ResNet50_HPF_Enabled.keras
Error loading model model_MobileNetV2_HPF_Disabled.keras: <class 'keras.src.models.functional.Functional'> could not be deserialized properly. Please ensure that components that are Python object instances (layers, models, etc.) returned by `get_config()` are explicitly deserialized in the model's `from_config()` method.

config={'module': 'keras.src.models.functional', 'class_name': 'Functional', 'config': {}, 'registered_name': 'Functional', 'build_config': {'input_shape': None}, 'compile_config': {'optimizer': {'module': 'keras.optimizers', 'class_name': 'AdamW', 'config': {'name': 'adamw', 'learning_rate': {'module': 'keras.optimizers.schedules', 'class_name': 'CosineDecay', 'config': {'initial_learning_rate': 1e-05, 'decay_steps': 4380, 'alpha': 0.1, 'name': 'CosineDecay', 'warmup_target': None, 'warmup_steps': 0}, 'registered_name': None}, 'weight_decay': 1e-05, 'clipnorm': None, 'global_clipnorm': None, 'clipvalue': None, 'use_ema': False, 'ema_momentum': 0.99, 'ema_overwrite_frequency': None, 'loss_scale_factor': None, 'gradient_accumulation_steps': None, 'beta_1': 0.9, 'beta_2': 0.999, 'epsilon': 1e-07, 'amsgrad': False}, 'registered_name': None}, 'loss': 'binary_crossentropy', 'loss_weights': None, 'metrics': ['accuracy', {'module': 'keras.metrics', 'class_name': 'Precision', 'config': {'name': 'precision', 'dtype': 'float32', 'thresholds': None, 'top_k': None, 'class_id': None}, 'registered_name': None}, {'module': 'keras.metrics', 'class_name': 'Recall', 'config': {'name': 'recall', 'dtype': 'float32', 'thresholds': None, 'top_k': None, 'class_id': None}, 'registered_name': None}, {'module': 'keras.metrics', 'class_name': 'AUC', 'config': {'name': 'auc', 'dtype': 'float32', 'num_thresholds': 200, 'curve': 'ROC', 'summation_method': 'interpolation', 'multi_label': False, 'num_labels': None, 'label_weights': None, 'from_logits': False}, 'registered_name': None}], 'weighted_metrics': None, 'run_eagerly': False, 'steps_per_execution': 1, 'jit_compile': True}}.

Exception encountered: <class 'keras.src.layers.core.lambda_layer.Lambda'> could not be deserialized properly. Please ensure that components that are Python object instances (layers, models, etc.) returned by `get_config()` are explicitly deserialized in the model's `from_config()` method.

config={'module': 'keras.layers', 'class_name': 'Lambda', 'config': {'name': 'Content_Preprocess', 'trainable': True, 'dtype': {'module': 'keras', 'class_name': 'DTypePolicy', 'config': {'name': 'float32'}, 'registered_name': None}, 'function': {'module': 'builtins', 'class_name': 'function', 'config': 'preprocess_input', 'registered_name': 'function'}, 'arguments': {}}, 'registered_name': None, 'build_config': {'input_shape': [None, 224, 224, 3]}, 'name': 'Content_Preprocess', 'inbound_nodes': [{'args': [{'class_name': '__keras_tensor__', 'config': {'shape': [None, 224, 224, 3], 'dtype': 'float32', 'keras_history': ['Input_Image', 0, 0]}}], 'kwargs': {'mask': None}}]}.

Exception encountered: Could not locate function 'preprocess_input'. Make sure custom classes and functions are decorated with `@keras.saving.register_keras_serializable()`. If they are already decorated, make sure they are all imported so that the decorator is run before trying to load them. Full object config: {'module': 'builtins', 'class_name': 'function', 'config': 'preprocess_input', 'registered_name': 'function'}
Traceback (most recent call last):
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_builder.py", line 206, in load_model_with_reconstruction
    new_model.load_weights(model_path)
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\utils\traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 645, in _raise_loading_failure
    raise ValueError(msg)
ValueError: A total of 3 objects could not be loaded. Example error message for object <Conv2D name=SRM_Filter_Bank, built=True>:

Layer 'SRM_Filter_Bank' expected 2 variables, but received 0 variables during loading. Expected: ['kernel', 'bias']

List of objects that could not be loaded:
[<Conv2D name=SRM_Filter_Bank, built=True>, <Conv2D name=SRM_to_RGB_Bottleneck, built=True>, <BatchNormalization name=Normalize_Noise_Stream, built=True>]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_service.py", line 47, in load_model
    model = load_model_with_reconstruction(str(model_path))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_builder.py", line 211, in load_model_with_reconstruction
    raise e
  File "D:\JOB_DATN\steganography_system\backend\app\services\model_builder.py", line 188, in load_model_with_reconstruction
    model = tf.keras.models.load_model(model_path, custom_objects=custom_objects)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_api.py", line 189, in load_model
    return saving_lib.load_model(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 365, in load_model
    return _load_model_from_fileobj(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 442, in _load_model_from_fileobj
    model = _model_from_config(
            ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\saving_lib.py", line 431, in _model_from_config
    model = deserialize_keras_object(
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\anpha\AppData\Roaming\Python\Python311\site-packages\keras\src\saving\serialization_lib.py", line 735, in deserialize_keras_object
    raise TypeError(
TypeError: <class 'keras.src.models.functional.Functional'> could not be deserialized properly. Please ensure that components that are Python object instances (layers, models, etc.) returned by `get_config()` are explicitly deserialized in the model's `from_config()` method.

config={'module': 'keras.src.models.functional', 'class_name': 'Functional', 'config': {}, 'registered_name': 'Functional', 'build_config': {'input_shape': None}, 'compile_config': {'optimizer': {'module': 'keras.optimizers', 'class_name': 'AdamW', 'config': {'name': 'adamw', 'learning_rate': {'module': 'keras.optimizers.schedules', 'class_name': 'CosineDecay', 'config': {'initial_learning_rate': 1e-05, 'decay_steps': 4380, 'alpha': 0.1, 'name': 'CosineDecay', 'warmup_target': None, 'warmup_steps': 0}, 'registered_name': None}, 'weight_decay': 1e-05, 'clipnorm': None, 'global_clipnorm': None, 'clipvalue': None, 'use_ema': False, 'ema_momentum': 0.99, 'ema_overwrite_frequency': None, 'loss_scale_factor': None, 'gradient_accumulation_steps': None, 'beta_1': 0.9, 'beta_2': 0.999, 'epsilon': 1e-07, 'amsgrad': False}, 'registered_name': None}, 'loss': 'binary_crossentropy', 'loss_weights': None, 'metrics': ['accuracy', {'module': 'keras.metrics', 'class_name': 'Precision', 'config': {'name': 'precision', 'dtype': 'float32', 'thresholds': None, 'top_k': None, 'class_id': None}, 'registered_name': None}, {'module': 'keras.metrics', 'class_name': 'Recall', 'config': {'name': 'recall', 'dtype': 'float32', 'thresholds': None, 'top_k': None, 'class_id': None}, 'registered_name': None}, {'module': 'keras.metrics', 'class_name': 'AUC', 'config': {'name': 'auc', 'dtype': 'float32', 'num_thresholds': 200, 'curve': 'ROC', 'summation_method': 'interpolation', 'multi_label': False, 'num_labels': None, 'label_weights': None, 'from_logits': False}, 'registered_name': None}], 'weighted_metrics': None, 'run_eagerly': False, 'steps_per_execution': 1, 'jit_compile': True}}.

Exception encountered: <class 'keras.src.layers.core.lambda_layer.Lambda'> could not be deserialized properly. Please ensure that components that are Python object instances (layers, models, etc.) returned by `get_config()` are explicitly deserialized in the model's `from_config()` method.

config={'module': 'keras.layers', 'class_name': 'Lambda', 'config': {'name': 'Content_Preprocess', 'trainable': True, 'dtype': {'module': 'keras', 'class_name': 'DTypePolicy', 'config': {'name': 'float32'}, 'registered_name': None}, 'function': {'module': 'builtins', 'class_name': 'function', 'config': 'preprocess_input', 'registered_name': 'function'}, 'arguments': {}}, 'registered_name': None, 'build_config': {'input_shape': [None, 224, 224, 3]}, 'name': 'Content_Preprocess', 'inbound_nodes': [{'args': [{'class_name': '__keras_tensor__', 'config': {'shape': [None, 224, 224, 3], 'dtype': 'float32', 'keras_history': ['Input_Image', 0, 0]}}], 'kwargs': {'mask': None}}]}.

Exception encountered: Could not locate function 'preprocess_input'. Make sure custom classes and functions are decorated with `@keras.saving.register_keras_serializable()`. If they are already decorated, make sure they are all imported so that the decorator is run before trying to load them. Full object config: {'module': 'builtins', 'class_name': 'function', 'config': 'preprocess_input', 'registered_name': 'function'}
